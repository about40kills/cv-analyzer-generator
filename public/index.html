<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CV Analyzer & Generator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f4f4f4;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 2rem;
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        color: #2c3e50;
        margin-bottom: 0.5rem;
      }

      .header p {
        color: #7f8c8d;
        font-size: 1.1rem;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .card {
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .card h2 {
        color: #2c3e50;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #3498db;
      }

      .upload-area {
        border: 2px dashed #3498db;
        border-radius: 10px;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
      }

      .upload-area:hover {
        border-color: #2980b9;
        background-color: #ecf0f1;
      }

      .upload-area.dragover {
        border-color: #27ae60;
        background-color: #d5f4e6;
      }

      .file-input {
        display: none;
      }

      .upload-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease;
      }

      .upload-btn:hover {
        background: #2980b9;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
        color: #2c3e50;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #bdc3c7;
        border-radius: 5px;
        font-size: 1rem;
      }

      .form-group textarea {
        height: 120px;
        resize: vertical;
      }

      .btn {
        background: #27ae60;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease;
        width: 100%;
      }

      .btn:hover {
        background: #219a52;
      }

      .btn:disabled {
        background: #95a5a6;
        cursor: not-allowed;
      }

      .results {
        grid-column: 1 / -1;
        display: none;
      }

      .results.show {
        display: block;
      }

      .analysis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .analysis-section {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 5px;
        border-left: 4px solid #3498db;
      }

      .analysis-section h3 {
        color: #2c3e50;
        margin-bottom: 1rem;
      }

      .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .skill-tag {
        background: #3498db;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.875rem;
      }

      .experience-item,
      .education-item {
        background: white;
        padding: 1rem;
        border-radius: 5px;
        margin-bottom: 1rem;
        border-left: 4px solid #27ae60;
      }

      .match-score {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1rem;
      }

      .match-score.high {
        color: #27ae60;
      }

      .match-score.medium {
        color: #f39c12;
      }

      .match-score.low {
        color: #e74c3c;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 2rem;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .analysis-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>CV Analyzer & Generator</h1>
        <p>
          Upload your CV for analysis and generate tailored versions for
          specific job positions
        </p>
      </div>

      <div class="main-content">
        <div class="card">
          <h2>Upload CV</h2>
          <div class="upload-area" id="uploadArea">
            <p>Drag and drop your CV here or click to browse</p>
            <button
              type="button"
              class="upload-btn"
              onclick="document.getElementById('fileInput').click()"
            >
              Choose File
            </button>
          </div>
          <input
            type="file"
            id="fileInput"
            class="file-input"
            accept=".pdf,.doc,.docx,.txt"
          />

          <div style="margin-top: 1rem">
            <strong>Selected file:</strong> <span id="fileName">None</span>
          </div>
        </div>

        <div class="card">
          <h2>Job Analysis</h2>
          <form id="analysisForm">
            <div class="form-group">
              <label for="jobTitle">Job Title</label>
              <input
                type="text"
                id="jobTitle"
                placeholder="e.g., Software Engineer"
              />
            </div>

            <div class="form-group">
              <label for="jobDescription">Job Description</label>
              <textarea
                id="jobDescription"
                placeholder="Paste the job description here..."
              ></textarea>
            </div>

            <div class="form-group">
              <label for="cvTemplate">CV Template</label>
              <select id="cvTemplate">
                <option value="modern">Modern</option>
                <option value="classic">Classic</option>
                <option value="creative">Creative</option>
                <option value="minimal">Minimal</option>
              </select>
            </div>

            <button type="submit" class="btn" id="analyzeBtn">
              Analyze CV
            </button>
          </form>
        </div>

        <div class="card results" id="results">
          <h2>Analysis Results</h2>

          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your CV...</p>
          </div>

          <div id="analysisResults" style="display: none">
            <div class="analysis-grid">
              <div class="analysis-section">
                <h3>Personal Information</h3>
                <div id="personalInfo"></div>
              </div>

              <div class="analysis-section">
                <h3>Job Match Score</h3>
                <div class="match-score" id="matchScore">--</div>
                <div id="matchDetails"></div>
              </div>
            </div>

            <div class="analysis-section">
              <h3>Skills</h3>
              <div class="skills-list" id="skillsList"></div>
            </div>

            <div class="analysis-section">
              <h3>Experience</h3>
              <div id="experienceList"></div>
            </div>

            <div class="analysis-section">
              <h3>Education</h3>
              <div id="educationList"></div>
            </div>

            <div class="analysis-section">
              <h3>Summary</h3>
              <div id="summary"></div>
            </div>

            <div style="margin-top: 2rem">
              <button class="btn" id="generatePdfBtn">
                Generate Tailored CV (PDF)
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let uploadedFile = null;
      let analysisData = null;

      // File upload handling
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const fileName = document.getElementById("fileName");

      uploadArea.addEventListener("click", () => fileInput.click());
      uploadArea.addEventListener("dragover", handleDragOver);
      uploadArea.addEventListener("drop", handleDrop);
      uploadArea.addEventListener("dragleave", handleDragLeave);

      fileInput.addEventListener("change", handleFileSelect);

      function handleDragOver(e) {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      }

      function handleDragLeave(e) {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
      }

      function handleDrop(e) {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      }

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          handleFile(file);
        }
      }

      function handleFile(file) {
        uploadedFile = file;
        fileName.textContent = file.name;
      }

      // Form submission
      document
        .getElementById("analysisForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          if (!uploadedFile) {
            alert("Please upload a CV first");
            return;
          }

          const jobTitle = document.getElementById("jobTitle").value;
          const jobDescription =
            document.getElementById("jobDescription").value;
          const cvTemplate = document.getElementById("cvTemplate").value;

          // Show loading
          document.getElementById("results").classList.add("show");
          document.getElementById("loading").classList.add("show");
          document.getElementById("analysisResults").style.display = "none";

          try {
            // Upload and analyze CV
            const formData = new FormData();
            formData.append("cv", uploadedFile);
            formData.append("jobTitle", jobTitle);
            formData.append("jobDescription", jobDescription);
            formData.append("template", cvTemplate);

            const response = await fetch("/api/analyze-cv", {
              method: "POST",
              body: formData,
            });

            if (!response.ok) {
              throw new Error("Analysis failed");
            }

            analysisData = await response.json();
            displayResults(analysisData);
          } catch (error) {
            console.error("Error:", error);
            alert("Error analyzing CV. Please try again.");
          } finally {
            document.getElementById("loading").classList.remove("show");
          }
        });

      function displayResults(data) {
        // Personal Information
        const personalInfo = document.getElementById("personalInfo");
        personalInfo.innerHTML = `
                <p><strong>Name:</strong> ${
                  data.personalInfo.name || "Not found"
                }</p>
                <p><strong>Email:</strong> ${
                  data.personalInfo.email || "Not found"
                }</p>
                <p><strong>Phone:</strong> ${
                  data.personalInfo.phone || "Not found"
                }</p>
            `;

        // Match Score
        const matchScore = document.getElementById("matchScore");
        const score = data.jobMatch?.matchScore || 0;
        matchScore.textContent = score + "%";
        matchScore.className = "match-score " + getScoreClass(score);

        // Skills
        const skillsList = document.getElementById("skillsList");
        skillsList.innerHTML = "";
        if (data.skills && data.skills.length > 0) {
          data.skills.forEach((skill) => {
            const skillTag = document.createElement("span");
            skillTag.className = "skill-tag";
            skillTag.textContent = skill;
            skillsList.appendChild(skillTag);
          });
        }

        // Experience
        const experienceList = document.getElementById("experienceList");
        experienceList.innerHTML = "";
        if (data.experience && data.experience.length > 0) {
          data.experience.forEach((exp) => {
            const expDiv = document.createElement("div");
            expDiv.className = "experience-item";
            expDiv.innerHTML = `
                        <h4>${exp.title}</h4>
                        <p><strong>Company:</strong> ${exp.company}</p>
                        <p><strong>Duration:</strong> ${exp.duration}</p>
                        <p>${exp.description}</p>
                    `;
            experienceList.appendChild(expDiv);
          });
        } else {
          experienceList.innerHTML = "<p>No experience found</p>";
        }

        // Education
        const educationList = document.getElementById("educationList");
        educationList.innerHTML = "";
        if (data.education && data.education.length > 0) {
          data.education.forEach((edu) => {
            const eduDiv = document.createElement("div");
            eduDiv.className = "education-item";
            eduDiv.innerHTML = `
                        <h4>${edu.degree}</h4>
                        <p><strong>Institution:</strong> ${edu.institution}</p>
                        <p><strong>Year:</strong> ${edu.year}</p>
                    `;
            educationList.appendChild(eduDiv);
          });
        } else {
          educationList.innerHTML = "<p>No education found</p>";
        }

        // Summary
        document.getElementById("summary").innerHTML = `<p>${
          data.summary || "No summary available"
        }</p>`;

        document.getElementById("analysisResults").style.display = "block";
      }

      function getScoreClass(score) {
        if (score >= 70) return "high";
        if (score >= 40) return "medium";
        return "low";
      }

      // PDF Generation
      document
        .getElementById("generatePdfBtn")
        .addEventListener("click", async () => {
          if (!analysisData) {
            alert("Please analyze your CV first");
            return;
          }

          try {
            const response = await fetch("/api/generate-pdf", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                cvData: analysisData,
                template: document.getElementById("cvTemplate").value,
              }),
            });

            if (!response.ok) {
              throw new Error("PDF generation failed");
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "tailored-cv.pdf";
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
          } catch (error) {
            console.error("Error:", error);
            alert("Error generating PDF. Please try again.");
          }
        });
    </script>
  </body>
</html>
